<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Исток — коттеджный поселок</title>
  <meta name="description" content="Коттеджный поселок Исток — природа, пруды, участки, инфраструктура. Узнайте о расположении, генплане, ценах и запишитесь на просмотр." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* CSS Variables */
    :root {
      /* Warm color palette */
      --bg: #f8f0e3;
      --card: #ffffff;
      --muted: #333333;
      --text: #000000;
      --accent: #906a41;
      --accent-2: #d4a574;
      --border: #e8d5c4;
      --input-bg: #f5ede1;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Layout */
    .cottage-container {
      width: min(1100px, 92%);
      margin: 0 auto;
    }

    /* Buttons */
    .cottage-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.9rem 1.2rem;
      border-radius: 14px;
      background: linear-gradient(180deg, #906a41, #7a5a37);
      border: 1px solid var(--border);
      color: #f8f0e3;
      font-weight: 600;
      transition: transform 0.08s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 12px rgba(144, 106, 65, 0.2);
      text-decoration: none;
      cursor: pointer;
    }

    .cottage-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(144, 106, 65, 0.3);
    }

    .cottage-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .cottage-btn--accent {
      background: linear-gradient(180deg, #906a41, #7a5a37);
      color: #f8f0e3;
    }

    /* Navigation Tags */
    .cottage-tag {
      display: inline-block;
      padding: 0.35rem 0.7rem;
      border: 1px solid var(--accent);
      border-radius: 999px;
      color: #f8f0e3;
      background: linear-gradient(180deg, #906a41, #7a5a37);
      font-size: 0.85rem;
      text-decoration: none;
      transition: transform 0.08s ease, box-shadow 0.2s ease;
      box-shadow: 0 2px 8px rgba(144, 106, 65, 0.2);
    }

    .cottage-tag:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(144, 106, 65, 0.3);
    }

    /* Navigation */
    .cottage-nav {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: rgba(248, 240, 227, 0.9);
      border-bottom: 1px solid var(--border);
    }

    .cottage-nav__row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 0;
    }

    .cottage-brand {
      display: flex;
      align-items: center;
      gap: 0.65rem;
      font-weight: 700;
      letter-spacing: 0.3px;
      color: var(--text);
      text-decoration: none;
    }

.cottage-brand .logo {
  background: none !important; /* убираем прямоугольник */
  box-shadow: none !important; /* убираем тень */
  width: 34px;
  height: 34px;
  border-radius: 0; /* если не нужен скругленный фон */
}

    /* Hero Section */
    .cottage-hero {
      position: relative;
      padding: 7rem 0 5rem;
      overflow: hidden;
    }

    .cottage-hero::before {
      content: "";
      position: absolute;
      inset: -10% -20% auto -20%;
      height: 120%;
      background: radial-gradient(800px 400px at 70% 10%, rgba(212, 165, 116, 0.14), transparent 60%),
                  radial-gradient(700px 380px at 10% 30%, rgba(144, 106, 65, 0.16), transparent 60%);
      pointer-events: none;
    }

    .cottage-hero__grid {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 2rem;
      align-items: center;
    }

    .cottage-h1 {
      font-size: clamp(2rem, 4.2vw, 3.4rem);
      line-height: 1.05;
      letter-spacing: 0.2px;
      margin: 0.6rem 0 1.2rem;
      color: var(--text);
    }

    .cottage-lead {
      color: var(--text);
      font-size: clamp(1rem, 1.4vw, 1.15rem);
      opacity: 0.95;
    }

    .cottage-hero__media {
      position: relative;
      aspect-ratio: 4/3;
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid var(--border);
      box-shadow: 0 20px 40px rgba(144, 106, 65, 0.15);
    }

    .cottage-hero__media img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      filter: saturate(105%);
    }

    /* Sections */
    .cottage-section {
      padding: 4.5rem 0;
      border-top: 1px solid var(--border);
    }

    .cottage-section h2 {
      font-size: clamp(1.4rem, 3vw, 2.1rem);
      margin: 0 0 1rem;
      color: var(--text);
    }

    .cottage-section h3 {
      font-size: clamp(1.2rem, 2.5vw, 1.8rem);
      margin: 0 0 0.8rem;
      color: var(--text);
    }

    /* Features */
    .cottage-features {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .cottage-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 1.2rem;
      box-shadow: 0 4px 12px rgba(144, 106, 65, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .cottage-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(144, 106, 65, 0.15);
    }

    .cottage-card h3 {
      margin: 0.4rem 0 0.3rem;
      font-size: 1.05rem;
      color: var(--text);
    }

    /* Gallery */
    .cottage-gallery {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 0.6rem;
    }

    .cottage-gallery img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    /* Master Plan */
    .master-plan-wrapper {
      background: var(--bg);
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      border-radius: 20px;
      border: 1px solid var(--border);
    }

    .master-plan-controls {
      margin: 10px 0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .master-plan-controls select, 
    .master-plan-controls input, 
    .master-plan-controls button {
      padding: 6px 8px;
      font-size: 14px;
      border: 1px solid var(--border);
      border-radius: 6px;
    }

    .master-plan-controls button {
      background: linear-gradient(180deg, #906a41, #7a5a37);
      color: #f8f0e3;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.2s ease;
      box-shadow: 0 2px 8px rgba(144, 106, 65, 0.2);
      font-weight: 600;
    }

    .master-plan-controls button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(144, 106, 65, 0.3);
    }

    .master-plan-container {
      position: relative;
      max-width: 100vw;
      max-height: 80vh;
      overflow: auto;
      border: 1px solid var(--border);
      background: var(--card);
      width: 100%;
      max-width: 1200px;
      height: 600px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(144, 106, 65, 0.08);
    }

    .master-plan-img {
      display: block;
      width: 100%;
      height: auto;
      user-select: none;
      pointer-events: none;
    }

    .master-plan-svg {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    .master-plan-svg polygon {
      pointer-events: all;
      cursor: pointer;
      stroke: #333;
      stroke-width: 1;
      transition: opacity 0.3s;
      outline: none;
    }

    .master-plan-svg polygon:hover {
      stroke-width: 3;
      stroke: orange;
    }

    .master-plan-svg polygon:focus {
      outline: none;
    }

    .status-Свободен { fill: rgba(144,238,144,0.5); }
    .status-Бронь { fill: rgba(255,255,0,0.5); }
    .status-Продан { fill: rgba(255,0,0,0.5); }

    .master-plan-tooltip {
      position: absolute;
      background: var(--card);
      border: 1px solid var(--border);
      padding: 8px 12px;
      font-size: 14px;
      pointer-events: none;
      display: none;
      z-index: 10;
      max-width: 90vw;
      word-wrap: break-word;
      box-shadow: 0 4px 12px rgba(144, 106, 65, 0.15);
      border-radius: 8px;
      box-sizing: border-box;
      color: var(--text);
    }

    .master-plan-legend {
      margin-top: 20px;
      display: flex;
      gap: 20px;
      font-size: 16px;
      user-select: none;
      justify-content: center;
      width: 100%;
      max-width: 1200px;
      background-color: var(--card);
      padding: 12px 20px;
      border-radius: 12px;
      box-sizing: border-box;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(144, 106, 65, 0.05);
      color: var(--text);
    }

    .master-plan-legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .master-plan-legend-color {
      width: 22px;
      height: 22px;
      border-radius: 3px;
    }

    .legend-Свободен { background: rgba(144,238,144,0.5); }
    .legend-Бронь { background: rgba(255,255,0,0.5); }
    .legend-Продан { background: rgba(255,0,0,0.5); }

    /* Lots */
    .cottage-lots {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .cottage-lot {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1rem;
      background: var(--card);
    }

    .cottage-lot .status {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .status--free {
      color: #059669;
    }

    .status--booked {
      color: #d97706;
    }

    .status--sold {
      color: #dc2626;
    }

    /* Houses */
    .cottage-houses {
      display: grid;
      gap: 2rem;
    }

    .cottage-house-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(144, 106, 65, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .cottage-house-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(144, 106, 65, 0.15);
    }

    .cottage-house-gallery {
      display: flex;
      gap: 0.8rem;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding-bottom: 0.5rem;
    }

    .cottage-house-gallery::-webkit-scrollbar {
      height: 4px;
    }

    .cottage-house-gallery::-webkit-scrollbar-track {
      background: var(--border);
      border-radius: 2px;
    }

    .cottage-house-gallery::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 2px;
    }

    .cottage-house-gallery img {
      flex-shrink: 0;
      width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    /* Location */
    .cottage-location__wrap {
      display: grid;
      grid-template-columns: 0.9fr 1.1fr;
      gap: 1rem;
    }

    .cottage-map {
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      min-height: 320px;
      background: var(--input-bg);
    }

    /* Forms */
    .cottage-form {
      display: grid;
      gap: 0.8rem;
    }

    .cottage-input,
    .cottage-textarea {
      width: 100%;
      padding: 0.9rem 1rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      transition: border-color 0.2s ease;
    }

    .cottage-input:focus,
    .cottage-textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(144, 106, 65, 0.1);
    }

    .cottage-textarea {
      min-height: 120px;
      resize: vertical;
    }

    /* Phone Button */
    .phone-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      left: auto;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #906a41, #7a5a37);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(144, 106, 65, 0.3);
      cursor: pointer;
      z-index: 1000;
      text-decoration: none;
      color: #f8f0e3;
      font-size: 24px;
      transition: all 0.3s ease;
      animation: phoneFloat 3s ease-in-out infinite;
    }

    .phone-button:hover {
      transform: scale(1.1) translateY(-2px);
      box-shadow: 0 8px 30px rgba(144, 106, 65, 0.4);
      background: linear-gradient(135deg, #a57649, #8a6040);
    }

    .phone-button:active {
      transform: scale(0.95);
      transition: transform 0.1s ease;
    }

    .phone-button::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: rgba(144, 106, 65, 0.3);
      animation: phoneRipple 2s infinite;
    }

    @keyframes phoneFloat {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes phoneRipple {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(1.5);
        opacity: 0;
      }
    }

    /* Cookie Banner */
    .cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card);
      border-top: 1px solid var(--border);
      padding: 1rem;
      box-shadow: 0 -4px 20px rgba(144, 106, 65, 0.1);
      z-index: 999;
      font-size: 0.9rem;
      color: var(--text);
      display: none;
    }

    .cookie-banner.show {
      display: block;
    }

    .cookie-banner-content {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .cookie-banner button {
      background: var(--accent);
      color: #f8f0e3;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      white-space: nowrap;
    }

    .cookie-banner button:hover {
      background: #7a5a37;
    }

    .cookie-banner a {
      color: var(--accent);
      text-decoration: underline;
    }

    /* Footer */
    .cottage-footer {
      padding: 3rem 0;
      border-top: 1px solid var(--border);
      color: var(--muted);
    }

    /* Responsive */
    @media (max-width: 920px) {
      .cottage-nav__row {
        flex-direction: column;
        gap: 1rem;
        align-items: center;
        text-align: center;
      }

      .cottage-nav__row nav {
        flex-wrap: wrap;
        justify-content: center;
      }

      .cottage-hero__grid,
      .cottage-location__wrap {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      
      .cottage-features {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .cottage-gallery {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .cottage-lots {
        grid-template-columns: repeat(2, 1fr);
      }

      .cottage-house-card > div {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
      }

      .cottage-house-gallery {
        order: -1;
      }

      .cottage-section {
        padding: 3rem 0;
      }

      .cottage-hero {
        padding: 5rem 0 3rem;
      }

      .master-plan-container {
        height: 400px;
      }

      .cottage-footer > div {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
      }
    }

    @media (max-width: 560px) {
      .cottage-container {
        width: min(1100px, 95%);
      }

      .cottage-nav {
        padding: 0 1rem;
      }

      .cottage-nav__row {
        padding: 1rem 0;
      }

      .cottage-brand {
        font-size: 0.9rem;
      }

      .cottage-nav__row nav {
        gap: 0.5rem;
      }

      .cottage-tag {
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
      }

      .cottage-hero {
        padding: 4rem 0 2.5rem;
      }

      .cottage-h1 {
        font-size: 1.8rem;
        line-height: 1.1;
      }

      .cottage-lead {
        font-size: 1rem;
      }

      .cottage-btn {
        padding: 0.8rem 1rem;
        font-size: 0.9rem;
      }

      .cottage-section {
        padding: 2.5rem 0;
      }

      .cottage-section h2 {
        font-size: 1.6rem;
        margin-bottom: 0.8rem;
      }

      .cottage-section h3 {
        font-size: 1.3rem;
      }

      .cottage-features {
        grid-template-columns: 1fr;
        gap: 0.8rem;
      }

      .cottage-card {
        padding: 1rem;
      }
      
      .cottage-gallery {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }

      .cottage-gallery img {
        height: 120px;
      }
      
      .cottage-lots {
        grid-template-columns: 1fr;
        gap: 0.8rem;
      }

      .cottage-lot {
        padding: 0.8rem;
      }

      .cottage-house-card {
        padding: 1rem;
      }

      .cottage-house-gallery img {
        width: 160px;
        height: 120px;
      }

      .cottage-form > div {
        grid-template-columns: 1fr !important;
      }

      .cottage-input,
      .cottage-textarea {
        padding: 0.8rem;
        font-size: 16px;
      }

      .master-plan-wrapper {
        padding: 15px;
      }

      .master-plan-controls {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
      }

      .master-plan-controls select, 
      .master-plan-controls input, 
      .master-plan-controls button {
        font-size: 16px;
        padding: 12px;
        width: 100%;
        box-sizing: border-box;
        border-radius: 8px;
      }

      .master-plan-container {
        height: 300px;
      }

      .master-plan-legend {
        flex-direction: column;
        gap: 15px;
        text-align: center;
        font-size: 14px;
      }

      .master-plan-legend-item {
        justify-content: center;
      }

      .cottage-hero__media {
        aspect-ratio: 3/2;
      }

      .cottage-hero > div div:first-child {
        text-align: center;
      }

      .cottage-hero > div div:first-child > div {
        justify-content: center;
      }
    }

    @media (max-width: 400px) {
      .cottage-container {
        width: min(1100px, 92%);
      }

      .cottage-h1 {
        font-size: 1.6rem;
      }

      .cottage-section {
        padding: 2rem 0;
      }

      .cottage-section h2 {
        font-size: 1.4rem;
      }

      .cottage-btn {
        padding: 0.7rem 0.9rem;
        font-size: 0.85rem;
      }

      .cottage-house-gallery img {
        width: 140px;
        height: 100px;
      }

      .master-plan-container {
        height: 250px;
      }

      .cottage-gallery img {
        height: 100px;
      }

      .phone-button {
        width: 50px;
        height: 50px;
        font-size: 20px;
        bottom: 15px;
        right: 15px;
        left: auto;
      }

      .cookie-banner-content {
        flex-direction: column;
        text-align: center;
        gap: 0.8rem;
      }

      .cottage-footer .cottage-container > div:first-child {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
      }

      .cottage-footer .cottage-container > div:last-child {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
    }
  
.cottage-gallery img {
  transition: transform 0.3s ease;
  cursor: pointer;
}
.cottage-gallery img:hover {
  transform: scale(1.05);
}


.cottage-house-gallery img {
  transition: transform 0.3s ease;
  cursor: pointer;
}
.cottage-house-gallery img:hover {
  transform: scale(1.05);
}



/* === Mobile header (burger) === */
.burger{
  display:none;
  flex-direction:column;
  gap:4px;
  cursor:pointer;
  z-index:1001;
}
.burger span{
  width:24px;
  height:3px;
  background:#906a41;
  border-radius:2px;
  transition:transform .3s, opacity .3s;
}

/* overlay behind the side panel */
.menu-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  opacity:0;
  pointer-events:none;
  transition:opacity .25s ease;
  z-index:1100;
}
.menu-overlay.show{
  opacity:1;
  pointer-events:auto;
}

/* side panel */
.mobile-menu{
  position:fixed;
  top:0;
  right:-100%;
  width:min(78vw,360px);
  height:100vh;
  background:rgba(248,240,227,.97);
  box-shadow:-6px 0 24px rgba(0,0,0,.2);
  padding:2rem 1.25rem;
  display:flex;
  flex-direction:column;
  gap:.75rem;
  transition:right .3s ease;
  z-index:1200;
}
.mobile-menu.show{ right:0; }
.mobile-menu a{
  font-size:1.05rem;
  padding:.6rem 0;
  border-bottom:1px solid var(--border);
  text-decoration:none;
  color:var(--text);
}

body.no-scroll{ overflow:hidden; }

/* ensure desktop keeps original nav */
@media (max-width: 560px){
  .cottage-nav__row nav{ display:none !important; }
  .burger{ display:flex; }
}



/* === Mobile brand/title/burger alignment tweaks === */
@media (max-width: 560px) {
  .cottage-nav__row {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 8px;
  }
  .cottage-brand {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    margin-right: auto !important;
  }
  .cottage-brand .logo {
    width: 32px !important;
    height: 32px !important;
  }
  .cottage-brand span {
    display: none !important;
  }
  .cottage-brand::after {
    content: "Исток";
    color: #906a41;
    font-weight: 700;
    font-size: 1.5rem;
    display: inline-block;
    height: 24px;
    line-height: 24px;
  }
  .burger {
    margin-left: 12px;
    height: 24px;
    display: flex;
    align-items: center;
  }
  .burger span {
    width: 24px;
    height: 3px;
  }
  .cottage-nav__row nav {
    display: none !important;
  }
}



/* === Extra Mobile Adjustments === */
@media (max-width: 560px) {

  /* 1) Make filter buttons same height as inputs */
  .master-plan-controls button {
    padding: 12px !important;
    font-size: 16px !important;
    height: 44px !important;
    flex: 1 1 auto;
  }

  /* 2) Enable zoom/pan for master plan */
  .master-plan-container {
    overflow: auto !important;
    touch-action: pan-x pan-y;
  }
  .master-plan-img {
    max-width: none !important;
    width: 1200px !important; /* allow scroll/zoom */
  }
  .master-plan-svg {
    width: 1200px !important;
    height: auto !important;
  }

  /* 3) Remove white space below genplan image */
  #map-container {
    margin-bottom: 0 !important;
  }

  /* 4) Legend inline instead of column */
  .master-plan-legend {
    flex-direction: row !important;
    gap: 15px !important;
    justify-content: center !important;
    text-align: center;
  }

  /* 5) House blocks same width as container */
  .cottage-houses {
    width: 100% !important;
  }
  .cottage-house-card {
    max-width: 100% !important;
    margin: 0 auto !important;
  }
  .cottage-house-card > div {
    grid-template-columns: 1fr !important;
  }
  .cottage-house-card h3 {
    font-size: 1.2rem !important;
  }
  .cottage-house-card p {
    font-size: 0.95rem !important;
    line-height: 1.4 !important;
  }

  /* 6) Equal width for hero buttons */
  .cottage-hero .cottage-btn {
    flex: 1 1 auto !important;
    min-width: 140px;
    text-align: center;
    justify-content: center;
  }
  .cottage-hero div[style*="flex-wrap"] {
    width: 100% !important;
    display: flex !important;
  }
}


@media (max-width: 560px) {
  /* === Fix house blocks === */
  .cottage-house-gallery img {
    width: 100% !important;
    height: auto !important;
    max-width: 320px;
    margin: 0 auto;
  }
  .cottage-house-card {
    text-align: center;
  }

  /* === Genplan zoom toggle === */
  .master-plan-container {
    overflow: hidden;
  }
  .master-plan-container.zoomed {
    overflow: auto;
  }
  .master-plan-container img {
    width: 100% !important;
  }
  .master-plan-container.zoomed img {
    width: 1200px !important;
  }

  /* === Equal filter buttons === */
  .master-plan-controls button {
    flex: 1;
    min-width: 45%;
    height: 48px !important;
    font-size: 16px !important;
    text-align: center;
  }
}

</style>
</head>
<body>
<!-- Navigation -->
<header class="cottage-nav">
  <div class="cottage-container cottage-nav__row" style="padding-left: 0; padding-right: 0; justify-content: space-between;">
    <a class="cottage-brand" href="#top" aria-label="Исток" style="margin-left: 0;">
      <img src="logo.png" alt="Логотип Исток" class="logo" 
           style="width:42px;height:42px;background:none;box-shadow:none;border-radius:0;">
      <span style="color:#906a41;">Исток — коттеджный поселок</span>
    </a>
    <div class="burger" id="burger" aria-label="Открыть меню" aria-expanded="false" aria-controls="mobileMenu"><span></span><span></span><span></span></div>
    <nav style="display: flex; gap: 0.8rem;">
      <a class="cottage-tag" href="#location">Расположение</a>
      <a class="cottage-tag" href="#plan">Генплан</a>
      <a class="cottage-tag" href="#lots">Участки</a>
      <a class="cottage-tag" href="#houses">Дома</a>
      <a class="cottage-tag" href="#contact">Заявка</a>
      <a class="cottage-tag" href="tel:+79991234567">📞 Позвонить</a>
      <a class="cottage-tag" href="https://t.me/village_istok" target="_blank">✈️ Telegram</a>
    </nav>
  </div>
</header>

<!-- Мобильное меню и оверлей -->
<div class="mobile-menu" id="mobileMenu" role="dialog" aria-modal="true">
  <a href="#location">Расположение</a>
  <a href="#plan">Генплан</a>
  <a href="#lots">Участки</a>
  <a href="#houses">Дома</a>
  <a href="#contact">Заявка</a>
  <a href="tel:+79991234567">📞 Позвонить</a>
  <a href="https://t.me/village_istok" target="_blank">✈️ Telegram</a>
</div>
<div class="menu-overlay" id="menuOverlay"></div>


  <main id="top">
    <!-- Hero Section -->
    <section class="cottage-hero">
      <div class="cottage-container cottage-hero__grid">
        <div>
          <span class="cottage-tag">Новый поселок у воды</span>
          <h1 class="cottage-h1">Жизнь на природе, среди лесов и прудов</h1>
          <p class="cottage-lead" style="color: var(--text);">
            Участки рядом с прудами и берёзовой рощей. Электричество и дороги, 
            общественные зоны и собственная философия «новой деревни» — для спокойной 
            жизни и дружного комьюнити.
          </p>
          <div style="display: flex; gap: 0.6rem; margin-top: 1.2rem; flex-wrap: wrap;">
            <a class="cottage-btn cottage-btn--accent" href="#contact">
              Записаться на просмотр
            </a>
            <a class="cottage-btn" href="#plan">
              Смотреть участки
            </a>
          </div>
          <div style="display: flex; flex-direction: column; gap: 0.3rem; margin-top: 1rem; color: var(--text); font-size: 0.95rem;"><span>⚡ 15 кВт</span><span>🛣️ Щебеночная дорога</span><span>🌊 Каскад водоемов</span><span>🏡 Общественные пространства</span></div>
        </div>
        <div class="cottage-hero__media" aria-label="Фото поселка">
          <img src="hero.jpeg" alt="Пейзаж с водой и полями" />
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section class="cottage-section">
      <div class="cottage-container">
        <h2>Почему «Исток»</h2>
        <p style="color: var(--text);">Коротко о самых важных преимуществах проекта.</p>
        <div class="cottage-features" style="margin-top: 1rem;">
          <article class="cottage-card">
            <div class="cottage-tag">Природа</div>
            <h3>Пруды и берёзовая роща</h3>
            <p style="color: var(--text);">
              Видовые участки, прогулочные тропы, места для рыбалки и пикников.
            </p>
          </article>
          <article class="cottage-card">
            <div class="cottage-tag">Инфраструктура</div>
            <h3>Коммуникации и дороги</h3>
            <p style="color: var(--text);">
              Электричество, подъездные пути и общественные пространства.
            </p>
          </article>
          <article class="cottage-card">
            <div class="cottage-tag">Сообщество</div>
            <h3>Новая деревня</h3>
            <p style="color: var(--text);">
              Соседские дворища и общие активности для жителей.
            </p>
          </article>
        </div>
      </div>
    </section>

    <!-- Location Section -->
<section id="location" class="cottage-section">
  <div class="cottage-container cottage-location__wrap">
    <div>
      <h2>Расположение и доступность</h2>
      <p style="color: var(--text);">
        Удобное расположение поселка обеспечивает лёгкий и быстрый доступ, сохраняя уединение и близость к природе
      </p>
      <ul style="color: var(--text); padding-left: 0; list-style: none;">
        <li style="margin-bottom: 0.5rem;">🚗 2 часа от МКАД (трасса М4 или М2), 1 час от Тулы</li>
        <li style="margin-bottom: 0.5rem;">🛒 Ближайшие магазины и фермерские продукты</li>
        <li style="margin-bottom: 0.5rem;">🏞️ Лес, водоемы и прогулочные тропы рядом</li>
        <li style="margin-bottom: 0.5rem;">🎓 Школа — в радиусе 10 км</li>
      </ul>
    </div>
    <div class="cottage-map" aria-label="Карта" style="width:100%;height:501px;">
      <script type="text/javascript" charset="utf-8" async
        src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3A1a5756d586b332b5d397d93476f657849d857dce38a7917883b6c4649ff0cd9e&amp;width=100%25&amp;height=501&amp;lang=ru_RU&amp;scroll=true">
      
// === Genplan zoom toggle ===
const mapContainerEl = document.getElementById("map-container");
const mapImgEl = document.getElementById("map-img");
if(mapContainerEl && mapImgEl){
  mapImgEl.addEventListener("click", () => {
    mapContainerEl.classList.toggle("zoomed");
  });
}

</script>
    </div>
  </div>
</section>

    <!-- Plan Section -->
<section id="plan" class="cottage-section">
  <div class="cottage-container">
    <h2>Генплан</h2>

    <div style="margin-top: 2rem; margin-bottom: 3rem;">
      <!-- Master Plan -->
      <div class="master-plan-wrapper">
        <div class="master-plan-controls">
          <!-- Inputs row -->
          <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-bottom:10px;">
            <input type="number" id="filter-num" placeholder="Номер участка" min="1" />
            <input type="number" id="filter-area-min" placeholder="Площадь от" min="0" step="0.01" />
            <input type="number" id="filter-area-max" placeholder="Площадь до" min="0" step="0.01" />
            <select id="filter-status">
              <option value="">Все статусы</option>
              <option value="Свободен">Свободен</option>
              <option value="Бронь">Бронь</option>
              <option value="Продан">Продан</option>
            </select>
          </div>

          <!-- Buttons row (centered) -->
          <div style="display:flex; justify-content:center; gap:20px; margin-top:10px;">
            <button class="btn" onclick="applyFilters()">Применить фильтры</button>
            <button class="btn secondary" onclick="resetFilters()">Сбросить фильтры</button>
          </div>
        </div>

        <div id="map-container" class="master-plan-container">
          <img id="map-img" class="master-plan-img" src="genplan.jpg" alt="Генеральный план поселка" />
          <svg id="map-svg" class="master-plan-svg" width="1200" height="900" aria-label="План участков"></svg>
          <div id="tooltip" class="master-plan-tooltip" role="tooltip" aria-hidden="true"></div>
        </div>

        <div class="master-plan-legend" aria-label="Легенда статусов участков">
          <div class="master-plan-legend-item">
            <div class="master-plan-legend-color legend-Свободен"></div> 
            Свободен
          </div>
          <div class="master-plan-legend-item">
            <div class="master-plan-legend-color legend-Бронь"></div> 
            Бронь
          </div>
          <div class="master-plan-legend-item">
            <div class="master-plan-legend-color legend-Продан"></div> 
            Продан
          </div>
        </div>
      </div>
    </div>

    <div>
      <h3>Галерея поселка</h3>
      <p style="color: var(--text); margin-bottom: 1rem;">
        Визуализации домов и уличных перспектив.
      </p>
      <div class="cottage-gallery">
        <img src="gallery1.jpeg" alt="Фото 1" />
        <img src="gallery2.jpeg" alt="Фото 2" />
        <img src="gallery3.jpeg" alt="Фото 3" />
        <img src="gallery4.jpg" alt="Фото 4" />
        <img src="gallery5.jpg" alt="Фото 5" />
        <img src="gallery6.jpg" alt="Фото 6" />
      </div>
    </div>
  </div>
</section>

    <!-- Lots Section -->
    <section id="lots" class="cottage-section">
      <div class="cottage-container">
        <h2>Акция до конца лета</h2>
        <p style="color: var(--text);">Выберите подходящий участок для строительства дома.</p>
        <div class="cottage-lots" id="lots-container">
          <!-- Lots will be populated by JavaScript -->
        </div>
      </div>
    </section>

    <!-- Houses Section -->
    <section id="houses" class="cottage-section">
      <div class="cottage-container">
        <h2>Готовые проекты домов</h2>
        <p style="color: var(--text);">
          Выберите готовый проект дома или закажите индивидуальный. 
          Строительство под ключ с гарантией качества.
        </p>
        <div class="cottage-houses" style="margin-top: 2rem;" id="houses-container">
          <!-- Houses will be populated by JavaScript -->
        </div>
      </div>
    </section>

<section class="cottage-section">
  <div class="cottage-container" style="display:flex; flex-wrap:wrap; align-items:center; gap:2rem;">
    <div style="flex:1 1 300px; min-width:250px;">
      <h2>О поселке Исток</h2>
      <p style="color: var(--text); line-height:1.5;">
        Познакомьтесь с нашим коттеджным поселком через короткое видео. Увидьте природу, дома и инфраструктуру, чтобы принять решение о покупке участка или дома.
      </p>
      <ul style="color: var(--text); padding-left: 1.2rem; line-height:1.5;">
        <li>Природные холмы и пруды</li>
        <li>Готовые проекты домов</li>
        <li>Общественные зоны и безопасность</li>
      </ul>
    </div>

    <!-- Видео справа — ВАРИАНТ A: contain -->
    <div style="flex:1 1 480px; max-width:600px;">
      <div style="position:relative; padding-bottom:56.25%; height:0; overflow:hidden; border-radius:12px; background:#000;">
        <video
          src="img/video.mp4"
          controls
          autoplay
          muted
          loop
          style="position:absolute; inset:0; width:100%; height:100%; border-radius:12px; object-fit:contain; background:#000;">
          Ваш браузер не поддерживает воспроизведение видео.
        </video>
      </div>
    </div>
  </div>
</section>

<section class="cottage-section">
  <div class="cottage-container">
    <div style="display:flex; flex-wrap:wrap; align-items:center; gap:1.5rem; background:#fefefe; padding:1.5rem; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.1); transition: transform 0.3s;">
      <img src="contact.jpg" alt="Фото менеджера" style="width:120px; height:120px; border-radius:50%; object-fit:cover; border:3px solid var(--accent);">
      <div style="flex:1 1 250px; min-width:200px;">
        <h3 style="margin:0 0 0.5rem;">Ваш менеджер</h3>
        <p style="margin:0.2rem 0; color: var(--text); font-weight:500;">Иван Иванов — специалист по продажам коттеджного поселка «Исток»</p>
        <p style="margin:0.2rem 0;">📞 <a href="tel:+79991234567" style="color:var(--accent); text-decoration:underline;">+7 (999) 123-45-67</a></p>
        <p style="margin:0.2rem 0;">💬 <a href="https://t.me/village_istok" target="_blank" style="color:var(--accent); text-decoration:underline;">@village_istok</a></p>
      </div>
    </div>
  </div>
</section>

    <!-- Contact Section -->
    <section id="contact" class="cottage-section">
      <div class="cottage-container">
        <h2>Записаться на просмотр</h2>
        <p style="color: var(--text);">
          Оставьте контакты — мы перезвоним и договоримся об удобном времени.
        </p>
        <form class="cottage-form" onsubmit="submitForm(event)">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem;">
            <input class="cottage-input" type="text" name="name" placeholder="Имя" required />
            <input class="cottage-input" type="tel" name="phone" placeholder="Телефон" required />
          </div>
          <input class="cottage-input" type="email" name="email" placeholder="Email (необязательно)" />
          <textarea class="cottage-textarea" name="comment" placeholder="Комментарий"></textarea>
          
          <!-- Privacy Consent -->
          <div style="margin: 1rem 0;">
            <label style="display: flex; align-items: flex-start; gap: 0.5rem; font-size: 0.9rem; color: var(--text); cursor: pointer;">
              <input type="checkbox" name="privacy_consent" required style="margin-top: 0.2rem; flex-shrink: 0;" />
              <span>
                Выражаю согласие на обработку моих персональных данных в соответствии с 
                <a href="privacy-policy.html" target="_blank" style="color: var(--accent); text-decoration: underline;">Политикой в отношении обработки персональных данных</a>
              </span>
            </label>
          </div>
          
          <!-- Marketing Consent -->
          <div style="margin: 1rem 0;">
            <label style="display: flex; align-items: flex-start; gap: 0.5rem; font-size: 0.9rem; color: var(--text); cursor: pointer;">
              <input type="checkbox" name="marketing_consent" style="margin-top: 0.2rem; flex-shrink: 0;" />
              <span>
                Я согласен (-на) на получение информационных и рекламных сообщений
              </span>
            </label>
          </div>

          <button class="cottage-btn cottage-btn--accent" type="submit">
            Отправить заявку
          </button>
        </form>
      </div>
    </section>

</main>

  <!-- Footer -->
  <footer class="cottage-footer">
    <div class="cottage-container">
      <div style="display: flex; justify-content: space-between; gap: 1rem; flex-wrap: wrap; margin-bottom: 2rem;">
        <div>© 2025 Исток. Все права защищены.</div>
        <div style="color: var(--muted);">ИП Иванов И.И. • ИНН 123456789012 • ОГРНИП 315123456789012</div>
      </div>
      
      <!-- Legal Links -->
      <div style="display: flex; gap: 2rem; flex-wrap: wrap; justify-content: center; margin-bottom: 1rem;">
        <a href="privacy-policy.html" target="_blank" style="color: var(--accent); text-decoration: underline; font-size: 0.9rem;">
          Политика в отношении обработки персональных данных
        </a>
        <a href="privacy-consent.html" target="_blank" style="color: var(--accent); text-decoration: underline; font-size: 0.9rem;">
          Согласие на обработку персональных данных
        </a>
        <a href="cookie-policy.html" target="_blank" style="color: var(--accent); text-decoration: underline; font-size: 0.9rem;">
          Согласие на использование файлов cookie
        </a>
      </div>
    </div>
  </footer>

  <!-- Phone Button -->
  <a href="tel:+79991234567" class="phone-button" aria-label="Позвонить нам" title="Позвонить: +7 (999) 123-45-67">
    📞
  </a>

  <!-- Cookie Banner -->
  <div id="cookie-banner" class="cookie-banner">
    <div class="cookie-banner-content">
      <div>
        Продолжая использовать сайт, Вы даете ИП Иванову И.И. (адрес: г. Москва, ул. Примерная, д. 1, ИНН 123456789012, ОГРНИП 315123456789012) 
        согласие на использование файлов cookie на сайте Оператора и обработку пользовательских данных. 
        Если Вы не хотите, чтобы Ваши данные обрабатывались, просим отключить обработку файлов cookie и сбор пользовательских данных 
        в настройках Вашего браузера или покинуть сайт. 
        <a href="cookie-policy.html" target="_blank">Подробнее об использовании файлов cookie</a>
      </div>
      <button onclick="acceptCookies()">Принять</button>
    </div>
  </div>

   <script>
    // Sample data
    const plots = [
      {
        num: 1,
        area: 11.17,
        price: "502650.00",
        status: "Свободен",
        points: [
          { x: 0.848046875, y: 0.8987847222222223 },
          { x: 0.877734375, y: 0.8932291666666666 },
          { x: 0.880078125, y: 0.9446180555555556 },
          { x: 0.851171875, y: 0.9460069444444444 }
        ]
      }
    ];

    const lots = [
      { num: 1, area: 12.5, price: 585000, status: 'Свободен' },
      { num: 2, area: 10.8, price: 520000, status: 'Бронь' },
      { num: 3, area: 14.2, price: 640000, status: 'Продан' },
      { num: 4, area: 9.9, price: 490000, status: 'Свободен' },
      { num: 5, area: 15.3, price: 680000, status: 'Свободен' },
      { num: 6, area: 11.7, price: 535000, status: 'Бронь' }
    ];

    const houses = [
      {
        id: 1,
        title: "Дом «Родник»",
        description: "Уютный, как ключ у родного дома. Для молодой семьи или дачи.",
        area: 80,
        price: 6120000,
        images: [
          "house1-1.jpg",
          "house1-2.jpg",
          "house1-3.jpg",
          "house1-4.jpg"
        ]
      },
      {
        id: 2,
        title: "Дом «Очаг»",
        description: "Семейный, тёплый, с центром вокруг общего стола.",
        area: 100,
        price: 7778000,
        images: [
          "house2-1.jpg",
          "house2-2.jpg",
          "house2-3.jpg",
          "house2-4.jpg"
        ]
      },
      {
        id: 3,
        title: "Дом «Луговица»",
        description: "Светлый и спокойный, как поле летом.",
        area: 110,
        price: 8057300,
        images: [
          "house3-1.jpg",
          "house3-2.jpg",
          "house3-3.jpg",
          "house3-4.jpg"
        ]
      },
      {
        id: 4,
        title: "Дом «Усад»",
        description: "Традиционный и устойчивый, для тех, кто ценит уклад.",
        area: 120,
        price: 8677000,
        images: [
          "house4-1.jpg",
          "house4-2.jpg",
          "house4-3.jpg",
          "house4-4.jpg"
        ]
      },
      {
        id: 5,
        title: "Дом «Родовое древо»",
        description: "Для большой семьи и будущих поколений.",
        area: 170,
        price: 12489000,
        images: [
          "house5-1.jpg",
          "house5-2.jpg",
          "house5-3.jpg",
          "house5-4.jpg"
        ]
      }
    ];

    // Utility functions
    function formatPrice(num) {
      return new Intl.NumberFormat('ru-RU').format(num) + ' ₽';
    }

    function getStatusClass(status) {
      if (status === 'Свободен') return 'status status--free';
      if (status === 'Бронь') return 'status status--booked';
      return 'status status--sold';
    }

    // Populate lots
function populateLots() {
  const container = document.getElementById('lots-container');
  container.innerHTML = lots.map(lot => {
    // Рассчитаем цену со скидкой, например, 10%
    const discount = 0.1;
    const discountedPrice = Math.round(lot.price * (1 - discount));

    return `
      <article class="cottage-lot">
        <div style="display: flex; justify-content: space-between; align-items: center; gap: 0.6rem;">
          <strong>Участок №${lot.num}</strong>
          <span class="${getStatusClass(lot.status)}">${lot.status}</span>
        </div>
        <div style="color: var(--text); margin: 0.4rem 0 0.6rem;">
          Площадь: <b style="color: var(--text);">${lot.area} сот.</b>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: end;">
          <div>
            <div style="color: var(--text);">Цена</div>
            <div style="font-size: 1.1rem; font-weight: 700;">
              <span style="text-decoration: line-through; color: var(--text); margin-right: 0.5rem;">${formatPrice(lot.price)}</span>
              <span style="color: red;">${formatPrice(discountedPrice)}</span>
            </div>
          </div>
          <a class="cottage-btn" href="#contact">Забронировать</a>
        </div>
      </article>
    `;
  }).join('');
}

    // Populate houses
   function populateHouses() {
  const container = document.getElementById('houses-container');
  container.innerHTML = houses.map(house => `
    <article class="cottage-house-card">
      <div style="display: grid; grid-template-columns: 1fr 300px; gap: 1.5rem; align-items: start;">
        <div>
          <h3 style="margin: 0 0 0.5rem; font-size: 1.3rem; color: var(--text);">${house.title}</h3>
          <p style="color: var(--text); margin-bottom: 1rem;">${house.description}</p>
          <div style="display: flex; gap: 2rem; margin-bottom: 1rem;">
            <div>
              <div style="color: var(--text); font-size: 0.9rem;">Площадь</div>
              <div style="font-weight: 600; color: var(--text);">${house.area} м²</div>
            </div>
            <div>
              <div style="color: var(--text); font-size: 0.9rem;">Цена</div>
              <div style="font-weight: 700; font-size: 1.2rem; color: var(--text);">${formatPrice(house.price)}</div>
            </div>
          </div>
          <a class="cottage-btn cottage-btn--accent" href="#contact">Получить консультацию</a>
        </div>
        <div>
          <div class="cottage-house-gallery" data-house-id="${house.id}">
            ${house.images.map((img, idx) => `<img src="${img}" alt="${house.title} - фото" data-index="${idx}" />`).join('')}
          </div>
        </div>
      </div>
    </article>
  `).join('');

  // Добавляем обработчики на каждую галерею отдельно
  document.querySelectorAll('.cottage-house-gallery').forEach(gallery => {
    const images = Array.from(gallery.querySelectorAll('img')).map(img => img.src);
    gallery.querySelectorAll('img').forEach(img => {
      img.addEventListener('click', e => {
        const index = parseInt(e.target.dataset.index);
        openLightbox(images, index);
      });
    });
  });
}

    // Master plan functionality
    const mapContainer = document.getElementById('map-container');
    const mapImg = document.getElementById('map-img');
    const svg = document.getElementById('map-svg');
    const tooltip = document.getElementById('tooltip');
    const filterNumInput = document.getElementById('filter-num');
    const filterAreaMinInput = document.getElementById('filter-area-min');
    const filterAreaMaxInput = document.getElementById('filter-area-max');
    const filterStatusSelect = document.getElementById('filter-status');

    function isTouchDevice() {
      return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
    }

    function showTooltip(event, plot) {
      tooltip.style.display = 'block';
      tooltip.setAttribute('aria-hidden', 'false');
      tooltip.innerHTML = `
        <b>Участок №${plot.num}</b><br>
        Площадь: ${plot.area} сот.<br>
        Цена: ${Math.round(parseFloat(plot.price)).toLocaleString('ru-RU')} ₽<br>
        Статус: ${plot.status}
      `;
      moveTooltip(event);
    }

    function hideTooltip() {
      tooltip.style.display = 'none';
      tooltip.setAttribute('aria-hidden', 'true');
      tooltip.dataset.currentPlot = '';
    }

    function moveTooltip(event) {
      const containerRect = mapContainer.getBoundingClientRect();
      const tooltipRect = tooltip.getBoundingClientRect();
      const viewportWidth = window.innerWidth;

      let left = event.clientX - containerRect.left + 15;
      let top = event.clientY - containerRect.top + 15;

      if (left + tooltipRect.width > containerRect.width) {
        left = event.clientX - containerRect.left - tooltipRect.width - 15;
        if (left < 0) left = 0;
      }

      if (left + tooltipRect.width > viewportWidth) {
        left = viewportWidth - tooltipRect.width - 10;
        if (left < 0) left = 0;
      }

      if (top + tooltipRect.height > containerRect.height) {
        top = event.clientY - containerRect.top - tooltipRect.height - 15;
        if (top < 0) top = 0;
      }

      tooltip.style.left = left + 'px';
      tooltip.style.top = top + 'px';
    }

    function renderPlots() {
      svg.innerHTML = '';
      tooltip.style.display = 'none';
      tooltip.setAttribute('aria-hidden', 'true');
      tooltip.dataset.currentPlot = '';

      const filterNum = filterNumInput.value.trim();
      const filterStatus = filterStatusSelect.value;
      const filterAreaMin = parseFloat(filterAreaMinInput.value);
      const filterAreaMax = parseFloat(filterAreaMaxInput.value);

      const width = mapImg.clientWidth;
      const height = mapImg.clientHeight;
      svg.setAttribute('width', width);
      svg.setAttribute('height', height);

      plots.forEach(plot => {
        if (filterNum && String(plot.num) !== filterNum) return;
        if (filterStatus && plot.status !== filterStatus) return;
        if (!isNaN(filterAreaMin) && plot.area < filterAreaMin) return;
        if (!isNaN(filterAreaMax) && plot.area > filterAreaMax) return;

        const pointsStr = plot.points.map(p => `${p.x * width},${p.y * height}`).join(' ');

        const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
        polygon.setAttribute('points', pointsStr);
        polygon.classList.add('status-' + plot.status);
        polygon.setAttribute('tabindex', 0);
        polygon.setAttribute('aria-label', `Участок №${plot.num}, площадь ${plot.area} соток, цена ${plot.price} рублей, статус ${plot.status}`);

        polygon.addEventListener('mouseenter', e => { if (!isTouchDevice()) showTooltip(e, plot); });
        polygon.addEventListener('mousemove', e => { if (!isTouchDevice()) moveTooltip(e); });
        polygon.addEventListener('mouseleave', e => { if (!isTouchDevice()) hideTooltip(); });
        polygon.addEventListener('click', e => {
          if (isTouchDevice()) {
            if (tooltip.style.display === 'block' && tooltip.dataset.currentPlot == plot.num) {
              hideTooltip();
            } else {
              showTooltip(e, plot);
              tooltip.dataset.currentPlot = plot.num;
            }
          }
        });

        svg.appendChild(polygon);
      });
    }

    function applyFilters() {
      renderPlots();
    }

    function resetFilters() {
      filterNumInput.value = '';
      filterStatusSelect.value = '';
      filterAreaMinInput.value = '';
      filterAreaMaxInput.value = '';
      renderPlots();
    }

    // Cookie Banner
    function showCookieBanner() {
      if (!localStorage.getItem('cookieConsent')) {
        document.getElementById('cookie-banner').classList.add('show');
      }
    }

    function acceptCookies() {
      localStorage.setItem('cookieConsent', 'accepted');
      document.getElementById('cookie-banner').classList.remove('show');
    }

    function submitForm(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      
      // Check privacy consent
      if (!formData.get('privacy_consent')) {
        alert('Необходимо дать согласие на обработку персональных данных для отправки заявки.');
        return;
      }
      
      // Here you would normally send the data to your server
      console.log('Form submitted:', Object.fromEntries(formData.entries()));
      
      alert('Спасибо за заявку! Мы свяжемся с вами в ближайшее время.');
      form.reset();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      populateLots();
      populateHouses();
      
      mapImg.addEventListener('load', renderPlots);
      if (mapImg.complete) {
        renderPlots();
      }
      window.addEventListener('resize', renderPlots);

      // Show cookie banner after a delay
      setTimeout(showCookieBanner, 1000);

      // --- Mobile menu (burger) ---
      const burger = document.getElementById('burger');
      const mobileMenu = document.getElementById('mobileMenu');
      const menuOverlay = document.getElementById('menuOverlay');

      function openMenu(){
        mobileMenu?.classList.add('show');
        menuOverlay?.classList.add('show');
        document.body.classList.add('no-scroll');
        burger?.setAttribute('aria-expanded','true');
      }
      function closeMenu(){
        mobileMenu?.classList.remove('show');
        menuOverlay?.classList.remove('show');
        document.body.classList.remove('no-scroll');
        burger?.setAttribute('aria-expanded','false');
      }

      burger?.addEventListener('click', (e) => {
        e.stopPropagation();
        if (mobileMenu?.classList.contains('show')) { closeMenu(); } else { openMenu(); }
      });
      menuOverlay?.addEventListener('click', closeMenu);
      mobileMenu?.querySelectorAll('a').forEach(a => a.addEventListener('click', closeMenu));
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMenu(); });
    });
  
function openLightbox(images, startIndex) {
  let index = startIndex;
  const viewer = document.createElement('div');
  viewer.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:9999;';
  
  const img = document.createElement('img');
  img.src = images[index];
  img.style.maxWidth = '90%';
  img.style.maxHeight = '90%';
  viewer.appendChild(img);
  
  const prev = document.createElement('div');
  prev.innerHTML = '&#10094;';
  prev.style.cssText = 'position:absolute;left:20px;color:white;font-size:3rem;cursor:pointer;user-select:none;';
  prev.onclick = e => { e.stopPropagation(); index = (index - 1 + images.length) % images.length; img.src = images[index]; };
  
  const next = document.createElement('div');
  next.innerHTML = '&#10095;';
  next.style.cssText = 'position:absolute;right:20px;color:white;font-size:3rem;cursor:pointer;user-select:none;';
  next.onclick = e => { e.stopPropagation(); index = (index + 1) % images.length; img.src = images[index]; };
  
  viewer.appendChild(prev);
  viewer.appendChild(next);
  viewer.onclick = () => document.body.removeChild(viewer);
  document.body.appendChild(viewer);
}

document.querySelectorAll('.cottage-gallery img').forEach((img, idx) => {
  img.addEventListener('click', () => {
    const srcs = Array.from(document.querySelectorAll('.cottage-gallery img')).map(i => i.src);
    openLightbox(srcs, idx);
  });
});

document.querySelectorAll('.cottage-house-gallery img').forEach((img, idx) => {
  img.addEventListener('click', () => {
    const srcs = Array.from(document.querySelectorAll('.cottage-house-gallery img')).map(i => i.src);
    openLightbox(srcs, idx);
  });
});


// === Genplan zoom toggle ===
const mapContainerEl = document.getElementById("map-container");
const mapImgEl = document.getElementById("map-img");
if(mapContainerEl && mapImgEl){
  mapImgEl.addEventListener("click", () => {
    mapContainerEl.classList.toggle("zoomed");
  });
}

</script>
</body>
</html>
